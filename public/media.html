<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Media Player</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.7"></script>
  <style>
    :root {
      --bg: #0f0f12;
      --surface: #18181c;
      --border: #2a2a30;
      --text: #e4e4e7;
      --muted: #71717a;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
    }
    h1 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 20px;
      letter-spacing: -0.02em;
    }
    .player-wrap {
      width: 100%;
      max-width: 960px;
      background: var(--surface);
      border-radius: 12px;
      border: 1px solid var(--border);
      overflow: hidden;
      margin-bottom: 20px;
    }
    .video-wrap {
      position: relative;
      width: 100%;
      aspect-ratio: 16/9;
      background: #000;
    }
    video {
      width: 100%;
      height: 100%;
      display: block;
    }
    .controls {
      padding: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }
    .url-input {
      flex: 1;
      min-width: 200px;
      padding: 10px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
    }
    .url-input::placeholder { color: var(--muted); }
    .url-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }
    .btn {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s;
    }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-primary:hover { background: var(--accent-hover); }
    .btn-secondary { background: var(--border); color: var(--text); }
    .btn-secondary:hover { background: #3f3f46; }
    .status { font-size: 13px; color: var(--muted); width: 100%; margin-top: 4px; }
    .status.error { color: #f87171; }
    .status.playing { color: #4ade80; }
    .hint { font-size: 13px; color: var(--muted); margin-bottom: 16px; max-width: 960px; width: 100%; }
    .hint code { background: var(--surface); padding: 2px 6px; border-radius: 4px; font-size: 12px; }
  </style>
</head>
<body>
  <p style="margin-bottom:12px;"><a href="/s/index.html" style="color:var(--muted);font-size:13px;text-decoration:none;">← Home</a></p>
  <h1>Media Player</h1>
  <p class="hint"><strong>Local video:</strong> Put files in the project <code>files</code> folder, then use <code>/api/files/stream?path=yourvideo.mp4</code> (full URL: <code>http://localhost:3000/api/files/stream?path=yourvideo.mp4</code>). Or put in <code>public/videos/</code> and use <code>http://localhost:3000/s/videos/yourvideo.mp4</code>.</p>
  <div class="player-wrap">
    <div class="video-wrap">
      <video id="video" controls playsinline></video>
    </div>
    <div class="controls">
      <input type="url" class="url-input" id="urlInput" placeholder="Enter video URL (.mp4, .m3u8, etc.)" value="" />
      <button type="button" class="btn btn-primary" id="playBtn">Play</button>
      <button type="button" class="btn btn-secondary" id="stopBtn">Stop</button>
      <div class="status" id="status">Enter a video URL and click Play</div>
    </div>
  </div>

  <script>
    const video = document.getElementById('video');
    const urlInput = document.getElementById('urlInput');
    const playBtn = document.getElementById('playBtn');
    const stopBtn = document.getElementById('stopBtn');
    const statusEl = document.getElementById('status');

    let hls = null;

    function setStatus(msg, type = '') {
      statusEl.textContent = msg;
      statusEl.className = 'status ' + type;
    }

    function stop() {
      if (hls) {
        hls.destroy();
        hls = null;
      }
      video.removeAttribute('src');
      video.load();
      setStatus('Stopped');
    }

    function play() {
      const url = urlInput.value.trim();
      if (!url) {
        setStatus('Please enter a video URL', 'error');
        return;
      }

      stop();

      const isHls = url.includes('m3u8') || url.endsWith('.m3u8');

      if (isHls && Hls.isSupported()) {
        hls = new Hls({ enableWorker: true });
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => setStatus('Playing', 'playing'));
        hls.on(Hls.Events.ERROR, (e, data) => {
          if (data.fatal) setStatus('Load failed: ' + (data.details || data.type), 'error');
        });
      } else if (isHls && video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', () => setStatus('Playing', 'playing'));
        setStatus('Playing', 'playing');
      } else {
        video.src = url;
        video.addEventListener('loadeddata', () => setStatus('Playing', 'playing'));
        video.addEventListener('error', () => setStatus('Load failed', 'error'));
        setStatus('Loading…');
      }
    }

    playBtn.addEventListener('click', play);
    stopBtn.addEventListener('click', stop);
    urlInput.addEventListener('keydown', (e) => e.key === 'Enter' && play());
  </script>
</body>
</html>
